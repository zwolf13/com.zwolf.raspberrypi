# fetch instagram page
curl 'https://www.instagram.com/p/Ca-KYGNMIpLVsE9MI6VV00pmAWtjTMYWHzlc9Y0/'
    -H 'User-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:100.0) Gecko/20100101 Firefox/100.0'
    -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8'
    -H 'Accept-Language: en-US,en;q=0.5'
    -H 'Accept-Encoding: gzip, deflate, br'
    -H 'Alt-Used: www.instagram.com'
    -H 'Connection: keep-alive'
    -H 'Cookie: csrftoken=Z5opmD9LaNKbZiHr0OGHYFpgkE7gfj6W; mid=YjxsUgAEAAH3n1g3uBCKQwAF5hCv; ig_did=ACB08B6F-D252-4FC7-81ED-4EECFE23CBB6; ig_nrcb=1; fbm_124024574287414=base_domain=.instagram.com; ds_user_id=3452129080; sessionid=3452129080%3AHISxmbMWZysBkB%3A25; shbid="19869\0543452129080\0541684933480:01f7da7dc0bcdb4ef933fb3a1f24f2f3766053bde9cfb0c75996e4cae6b9a043615aa460"; shbts="1653397480\0543452129080\0541684933480:01f7ec716c837804dade3e17f2831651e9c7fe837d855bb4c33752c93a962ae14c07bdb1"; fbsr_124024574287414=9IRe4MqoBEjjOeAjuu5Ev6nmt-n1D0cx8iliS4_SOVc.eyJ1c2VyX2lkIjoiNjAyNjE5Nzg2IiwiY29kZSI6IkFRQm9LLVIzVExMQ3E3TW1DU2JaSzQ2R2ZvWE1pc0JCaFUwUmMwUGUxdm40Rjd6RFpFQWR0MGpqcWs4VVJQSndpcmVhVXFxZm1MSkdsNGMwaWN6MlVac09RRXFmLTZWNlViTzdhZW9hOG5iTHFYdEFUdnRySGhSZ1NsZW1pTHRUaDFPdS1sbzlGdXJsX25ZQUFXY0xmSzNpWDE5WDlucFB4UG1UU1JVS3YyclNNUkF2NVBxRm1wMWVtU25EbHMzOFNtOFJiZkY4Q09QM1RTLXQ4Uzd1UzQ4SFdSVVVKWGx0MGhKRmxFQmswQjFaaVIza1VwV1FoejhPRWVOUjdLcDZfZ0lLY2o2bU1DLWIzdFBkckRlN1BjZHI0bzNLZmZ1a0h0eWk1NVdQaGxJd0R0NTV4MzJVNko4a1g1dlppdzZDMm1JIiwib2F1dGhfdG9rZW4iOiJFQUFCd3pMaXhuallCQUwxdnB0WkJBd2haQXM1eERma0F4TU1XMzNLZmxCeFpDNnp6RXdvRjRSOW1QWkFjZGpSZ0J0clpDSEFIdzdXZkxScFhIY1VSUWhnNnQ3MVpBdHNXSVJUWkFuN1RUQkdzU3F0Sm96VE85MjlmR2VCQUx3cGZ1YnVPT0pqWVJDSGhoUDJMbkhlb2NjdTJHTUhMczNITDJzNExoODRScnFtejFrZTJCdWhEdTV6IiwiYWxnb3JpdGhtIjoiSE1BQy1TSEEyNTYiLCJpc3N1ZWRfYXQiOjE2NTM1MTg4MDh9; rur="NAO\0543452129080\0541685054849:01f7001fc25d64cd8ec7e9b71a8a2eefe8c4193e04fb85e776b54e5d47c5c4f77a215019"; fbsr_124024574287414=6858YJJLy-49K8qB7tcoP1BbTxBjnM3Xip78YSfanZg.eyJ1c2VyX2lkIjoiNjAyNjE5Nzg2IiwiY29kZSI6IkFRQThYMnZpLVNDdDdsY3NUY0FBaHB0RXBLM1laQWFEdkdKSXVlN0FsOERNNm9vQUlPZXRfZUtiYzZoTktyT2dCRmpLVFJyNVVHdEs3MXprWVZQQTI1azFPcmhGUUJBc2tYUDRWMkVDdWU4XzJXalBIWkdUN1dPb2lCNFRiNW50ejNpTWJxbkE5d2ZMd1JsSHJYMjBEelZZN0Jqa0tkNXJERERmWlZ3OW5hb2lMYmhKZndRWXJHTUpqM3puaEJmVzJvRm1jQ3YzeXVCU2kyTnlINkVXU0dBRnYySmg0Szhwd0paaTdmbE1EeDM3NVFkV25QTEVuUHpIOW9yX2Z1QjVySFJfNXpEZUpWVkRPcW1VLVZ3U0t6em9FWWdFRGxKTkFSUFhFdEJXcXpGRzVTdHl4M2JDTnlEZ3JZUjcwRGV3Vl9zIiwib2F1dGhfdG9rZW4iOiJFQUFCd3pMaXhuallCQU9neG9tSGlIeURpQ1BKR1pDS1NOT1BDdkdjdGlkZ0JtUU9XTFpBOEJaQnF2WkJLV0VGbVEyaWF2dW5iSXJsZ25WVlpBdFdZdVRXdXN0dTBzZTJHZ3NPSXRGV3NQZndvVzFaQlRkRDhHUVhvUmNTcEpaQTB6U2VVS05rYkJVSGk3bjg4SG5PdEk0dVpBWHcxVnlSR1ZiMWxETFVTczhoVWlmVVpCVzdCZklEeFMiLCJhbGdvcml0aG0iOiJITUFDLVNIQTI1NiIsImlzc3VlZF9hdCI6MTY1MzUxNjY5Mn0'
    -H 'Upgrade-Insecure-Requests: 1'
    -H 'Sec-Fetch-Dest: document'
    -H 'Sec-Fetch-Mode: navigate'
    -H 'Sec-Fetch-Site: none'
    -H 'Sec-Fetch-User: ?1'
    -H 'TE: trailers'

# min instagram
curl 'https://www.instagram.com/p/Ca-KYGNMIpLVsE9MI6VV00pmAWtjTMYWHzlc9Y0/' \
  -H 'User-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:100.0) Gecko/20100101 Firefox/100.0' \
  -H 'Cookie: csrftoken=Z5opmD9LaNKbZiHr0OGHYFpgkE7gfj6W; mid=YjxsUgAEAAH3n1g3uBCKQwAF5hCv; ig_did=ACB08B6F-D252-4FC7-81ED-4EECFE23CBB6; ig_nrcb=1; fbm_124024574287414=base_domain=.instagram.com; ds_user_id=3452129080; sessionid=3452129080%3AHISxmbMWZysBkB%3A25; shbid="19869\0543452129080\0541684933480:01f7da7dc0bcdb4ef933fb3a1f24f2f3766053bde9cfb0c75996e4cae6b9a043615aa460"; shbts="1653397480\0543452129080\0541684933480:01f7ec716c837804dade3e17f2831651e9c7fe837d855bb4c33752c93a962ae14c07bdb1"; fbsr_124024574287414=9IRe4MqoBEjjOeAjuu5Ev6nmt-n1D0cx8iliS4_SOVc.eyJ1c2VyX2lkIjoiNjAyNjE5Nzg2IiwiY29kZSI6IkFRQm9LLVIzVExMQ3E3TW1DU2JaSzQ2R2ZvWE1pc0JCaFUwUmMwUGUxdm40Rjd6RFpFQWR0MGpqcWs4VVJQSndpcmVhVXFxZm1MSkdsNGMwaWN6MlVac09RRXFmLTZWNlViTzdhZW9hOG5iTHFYdEFUdnRySGhSZ1NsZW1pTHRUaDFPdS1sbzlGdXJsX25ZQUFXY0xmSzNpWDE5WDlucFB4UG1UU1JVS3YyclNNUkF2NVBxRm1wMWVtU25EbHMzOFNtOFJiZkY4Q09QM1RTLXQ4Uzd1UzQ4SFdSVVVKWGx0MGhKRmxFQmswQjFaaVIza1VwV1FoejhPRWVOUjdLcDZfZ0lLY2o2bU1DLWIzdFBkckRlN1BjZHI0bzNLZmZ1a0h0eWk1NVdQaGxJd0R0NTV4MzJVNko4a1g1dlppdzZDMm1JIiwib2F1dGhfdG9rZW4iOiJFQUFCd3pMaXhuallCQUwxdnB0WkJBd2haQXM1eERma0F4TU1XMzNLZmxCeFpDNnp6RXdvRjRSOW1QWkFjZGpSZ0J0clpDSEFIdzdXZkxScFhIY1VSUWhnNnQ3MVpBdHNXSVJUWkFuN1RUQkdzU3F0Sm96VE85MjlmR2VCQUx3cGZ1YnVPT0pqWVJDSGhoUDJMbkhlb2NjdTJHTUhMczNITDJzNExoODRScnFtejFrZTJCdWhEdTV6IiwiYWxnb3JpdGhtIjoiSE1BQy1TSEEyNTYiLCJpc3N1ZWRfYXQiOjE2NTM1MTg4MDh9; rur="NAO\0543452129080\0541685054849:01f7001fc25d64cd8ec7e9b71a8a2eefe8c4193e04fb85e776b54e5d47c5c4f77a215019"; fbsr_124024574287414=6858YJJLy-49K8qB7tcoP1BbTxBjnM3Xip78YSfanZg.eyJ1c2VyX2lkIjoiNjAyNjE5Nzg2IiwiY29kZSI6IkFRQThYMnZpLVNDdDdsY3NUY0FBaHB0RXBLM1laQWFEdkdKSXVlN0FsOERNNm9vQUlPZXRfZUtiYzZoTktyT2dCRmpLVFJyNVVHdEs3MXprWVZQQTI1azFPcmhGUUJBc2tYUDRWMkVDdWU4XzJXalBIWkdUN1dPb2lCNFRiNW50ejNpTWJxbkE5d2ZMd1JsSHJYMjBEelZZN0Jqa0tkNXJERERmWlZ3OW5hb2lMYmhKZndRWXJHTUpqM3puaEJmVzJvRm1jQ3YzeXVCU2kyTnlINkVXU0dBRnYySmg0Szhwd0paaTdmbE1EeDM3NVFkV25QTEVuUHpIOW9yX2Z1QjVySFJfNXpEZUpWVkRPcW1VLVZ3U0t6em9FWWdFRGxKTkFSUFhFdEJXcXpGRzVTdHl4M2JDTnlEZ3JZUjcwRGV3Vl9zIiwib2F1dGhfdG9rZW4iOiJFQUFCd3pMaXhuallCQU9neG9tSGlIeURpQ1BKR1pDS1NOT1BDdkdjdGlkZ0JtUU9XTFpBOEJaQnF2WkJLV0VGbVEyaWF2dW5iSXJsZ25WVlpBdFdZdVRXdXN0dTBzZTJHZ3NPSXRGV3NQZndvVzFaQlRkRDhHUVhvUmNTcEpaQTB6U2VVS05rYkJVSGk3bjg4SG5PdEk0dVpBWHcxVnlSR1ZiMWxETFVTczhoVWlmVVpCVzdCZklEeFMiLCJhbGdvcml0aG0iOiJITUFDLVNIQTI1NiIsImlzc3VlZF9hdCI6MTY1MzUxNjY5Mn0' \
  --output instagram.html


curl 'https://www.instagram.com/p/Ca-KYGNMIpLVsE9MI6VV00pmAWtjTMYWHzlc9Y0/' \
-H 'User-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:100.0) Gecko/20100101 Firefox/100.0' \
-H 'Cookie: csrftoken=Z5opmD9LaNKbZiHr0OGHYFpgkE7gfj6W; mid=YjxsUgAEAAH3n1g3uBCKQwAF5hCv; ig_did=ACB08B6F-D252-4FC7-81ED-4EECFE23CBB6; ig_nrcb=1; fbm_124024574287414=base_domain=.instagram.com; ds_user_id=3452129080; sessionid=3452129080%3AHISxmbMWZysBkB%3A25; shbid="19869\0543452129080\0541684933480:01f7da7dc0bcdb4ef933fb3a1f24f2f3766053bde9cfb0c75996e4cae6b9a043615aa460"; shbts="1653397480\0543452129080\0541684933480:01f7ec716c837804dade3e17f2831651e9c7fe837d855bb4c33752c93a962ae14c07bdb1"; fbsr_124024574287414=hBFgbp8_-csv9ZMPEgO9bTth-Jj8pcrApcYDjHMSPgs.eyJ1c2VyX2lkIjoiNjAyNjE5Nzg2IiwiY29kZSI6IkFRQmRUaEFjbDFBWGNmN3ktQ1BhdHRzbGs3ZE1ZMWo0YUROekdtSHpJVUZRdkE1Nk1tc2pBSHB6d2htSzd2MDFEdlZZbF9tZUhwUTBfcVNyQXgyWEVIOFhHUVFNQ3g4eDlrb1JHdjVzdE8xOVozMHpWNUtQWWNDRGJuQUlfbngyX0hBczBacFRCWlJrQzNDdzFmZk9ad0xtZ3NwcS0wMHU5eHlWelBGaGZERmVBVTAtV2U3U2MyM0J4R3FuZHE0ekpMV043Zm13RGp3dk5iYTVqbm5VTXV0a3VXZnpfR04wNEJPbURfdWgyTzFzSHRSZnJwOHFGbXFvSTlPb1R0Vm5UVkRQQXRzZndKUXloWFJpZXEwcXU1SmNuX1NNZ0Z4dUhMMzhxQndKemVRMmNZd1JJN2NRcFRwdnJOdHVUTldZOGkwIiwib2F1dGhfdG9rZW4iOiJFQUFCd3pMaXhuallCQUFTbjZVMHFoQnBpaVpBeHhrZnA5MWVEbGI3RHhsNjFqQU5lcGJIU0psTEllWkNHaEVxNk1yckk4Vmd6U3JDVW52SzFRbXZtNkVHYmk3VXpZbXhnTlpDeHV3ZEZMT2p2SjdhbUtCSFpDd292cFhtalk1dVVtbVN3WTQ3OHdSZTJaQko1c3JlSzRsTTh1SkRZMXF5MVpCMTVPbFJCWkJUUHp0aFhrTHpWdzNlIiwiYWxnb3JpdGhtIjoiSE1BQy1TSEEyNTYiLCJpc3N1ZWRfYXQiOjE2NTM1OTI3ODV9; rur="NCG\0543452129080\0541685128538:01f79d1a9ee1aa131793acd9c7d2255efe098c75ca7d7ca5ce3f76774b51d2acbfe3904e"' \
--output instagram.html

# To extract additionalDataLoaded
grep -oP "(?<=<script type=\"text/javascript\">window\.__additionalDataLoaded\('/p/Ca-KYGNMIpLVsE9MI6VV00pmAWtjTMYWHzlc9Y0/',).*(?=\);<\/script>)" instagram.html | python -m json.tool > additionalDataLoaded.json

page_title = re.search(r"\<title\>$\n(.*?)$\n\<\/title\>", content, re.M).group(1)

additionalDataLoaded = re.search(r"window\.__additionalDataLoaded\(\'/p/Ca-KYGNMIpLVsE9MI6VV00pmAWtjTMYWHzlc9Y0/\',(.*?);<\/script>", content).group(1)




##############################################################################################################

https://github.com/chris-greening/instascrape

# https://stackoverflow.com/questions/61819842/how-can-i-login-in-instagram-with-python-requests
# https://github.com/softcoder24/insta_share
# https://requests.readthedocs.io/en/latest/
# https://docs.python.org/3/library/http.cookiejar.html
# https://stackoverflow.com/questions/14742899/using-cookies-txt-file-with-python-requests

from http.cookiejar import MozillaCookieJar
import requests
from bs4 import BeautifulSoup

cookies = MozillaCookieJar('cookies.instagram.txt')
cookies.load(ignore_expires = True)

url = 'https://www.instagram.com/p/Ca-KYGNMIpLVsE9MI6VV00pmAWtjTMYWHzlc9Y0/'

r = requests.get(url, cookies=cookies)
soup = BeautifulSoup(r.text, 'html.parser')
soup.title.text


# https://stackoverflow.com/questions/61819842/how-can-i-login-in-instagram-with-python-requests
import os
import requests
import getpass
import json
import io
import time

link = 'https://www.instagram.com/accounts/login/'
login_url = 'https://www.instagram.com/accounts/login/ajax/'

time = int(datetime.now().timestamp())
response = requests.get(link)
csrf = response.cookies['csrftoken']

payload = {
    'username': username,
    'enc_password': f'#PWD_INSTAGRAM_BROWSER:0:{time}:{password}',
    'queryParams': {},
    'optIntoOneTap': 'false'
}

login_header = {
    "User-Agent": "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36",
    "X-Requested-With": "XMLHttpRequest",
    "Referer": "https://www.instagram.com/accounts/login/",
    "x-csrftoken": csrf
}

login_response = requests.post(login_url, data=payload, headers=login_header)
json_data = json.loads(login_response.text)

if json_data["authenticated"]:

    print("login successful")
    cookies = login_response.cookies
    cookie_jar = cookies.get_dict()
    csrf_token = cookie_jar['csrftoken']
    print("csrf_token: ", csrf_token)
    session_id = cookie_jar['sessionid']
    print("session_id: ", session_id)
else:
    print("login failed ", login_response.text)
